geom_vline(xintercept = as.Date("2020-03-11"), color = "green")+
geom_vline(xintercept = as.Date("2020-02-26"), color = "red")+
labs(title = "Fecha de aplicación",
x = "Fecha",
y = "Cantidad de encuestas")
library(readxl)
library(janitor)
library(magrittr)
library(dplyr)
library(sjmisc)
library(ggplot2)
library(kableExtra)
library(tidyr)
library(haven)
library(stringr)
bd_ppal <- read_sav("../../Digitaciones/1. Encuestas/Base principal/base principal_200414.sav") %>%
clean_names() %>%
mutate(folio = as.character(folio),
n_prob_enc = case_when((problema_1 == 0)~0,
(problema_2 == 0)~1,
TRUE~2),
fecha = as.Date(str_c('2020','-',mes,'-',dia))) %>%
select(folio,
folio_2,
starts_with("problema_"),
n_prob_enc,
fecha)
bd_prob <- read_sav("../../Digitaciones/1. Encuestas/Base problemas/base problemas_200415.sav") %>%
clean_names()
bd_coord <- readxl::read_xlsx("../1. Encuestas/200414 - coordinacion Necesidades Juridicas.xlsx",
col_types = c("numeric",
"numeric",
"numeric",
"numeric",
"numeric",
"numeric",
"text",
"text",
"text",
"text",
"text",
"text",
"text",
"numeric",
"text",
"numeric",
"numeric",
"text",
"date")) %>%
mutate(folio = as.character(folio_uc),
a = as.numeric(n_prob_enc),
b = as.numeric(n_prob_p)) %>%
select(-n_prob_enc,
-n_prob_p,
-fecha)
bd_prob %>%
mutate(folio_2 = ifelse((nchar(folio)) == 5,str_c(substr(folio,1,3),"-",n_prob),str_c(substr(folio,1,4),"-",n_prob)),
check_fol = ifelse((folio == folio_2),1,0)) %>%
filter(check_fol == 0) %>%
select(folio,folio_2,n_prob,check_fol)
bd_prob <- bd_prob %>%
mutate(folio_2 =  ifelse((nchar(folio)) == 5,substr(folio,1,3),substr(folio,1,4))) %>%
add_count(folio_2) %>%
rename('n_prob_p' = n) %>%
filter(duplicated(folio_2, incomparables = FALSE) == FALSE) %>%
select(folio_2,
n_prob_p) %>%
rename('folio' = folio_2)
bd_un <- left_join(bd_ppal,
bd_prob,
by = 'folio') %>%
mutate(n_prob_p = ifelse((is.na(n_prob_p)),0,n_prob_p))
bd_coord_un <- left_join(bd_coord,
bd_un,
by = 'folio')
bd_coord_un <- bd_coord_un %>%
mutate(dif_prob = ifelse((n_prob_enc != n_prob_p),"dif","bien"))
bd_coord_un %>%
mutate(fol2 = ifelse((is.na(fol2)),folio_2,fol2)) %>%
select(folio_uc:sup_tel,
starts_with('n_prob'),
dif_prob,
fecha) %>%
writexl::write_xlsx("../1. Encuestas/200414 - coordinacion Necesidades Juridicas.xlsx")
coord_nj <- readxl::read_xlsx("../1. Encuestas/200414 - coordinacion Necesidades Juridicas.xlsx",
col_types = c("numeric",
"numeric",
"numeric",
"numeric",
"numeric",
"numeric",
"text",
"text",
"text",
"text",
"text",
"text",
"text",
"numeric",
"text",
"numeric",
"numeric",
"text",
"date")) %>%
clean_names() %>%
mutate(estado = factor(estado, levels = c("Recepción - ingreso", "Supervisión oficina", "Rechazo por incompleta", "Rechazo por selección de personas (Kish)", "Rechazo por mala aplicación módulo problemas", "Sacada de base por incompleta", "Digitación", "Aceptada")),
region = factor(region, levels = 1:16))
coord_nj %>%
filter(!is.na(estado)) %>%
frq(estado) %>%
adorn_totals("row")
coord_nj %>%
filter(estado == "Aceptada") %>%
add_count(n_prob_p,region) %>%
rename("num" = n) %>%
add_count(region) %>%
mutate(porc = num/n) %>%
filter(n_prob_p == 2) %>%
select(folio_uc,region,n_prob_p,porc) %>%
ggplot(aes(x = region, y = porc))+
geom_text(aes(y = porc, label = scales::percent(porc))) +
scale_y_continuous()+
labs(title = "Porcentaje de encuestas con dos problemas",
subtitle = "Encuestas en base de datos",
x = "Región",
y = "%")
install.packages('vitae')
install.packages("vitae")
install.packages("scholar")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(vitae)
pisula.log
shiny::runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
runApp('C:/Users/Andres/Desktop/GitHub/shiny_futbol/shiny_futbol')
library(shiny)
library(sjmisc)
library(dplyr)
library(plotly)
library(ggplot2)
# Lectura de base
df_torneos <- readxl::read_xlsx('base_torneos.xlsx') %>%
janitor::clean_names()
# Limpieza torneo 1999
df_99a <- df_torneos %>%
mutate(ind_pos = ifelse((year %in% c('1999-1','1999-2')& (pos >= 9)),1,0)) %>%
filter(year %in% c('1999-1','1999-2') & ind_pos == 0) %>%
group_by(equipo) %>%
mutate(pts = sum(pts),
pj = sum(pj),
pg = sum(pg),
pe = sum(pe),
pp = sum(pp),
gf = sum(gf),
gc = sum(gc),
dif = gf-gc) %>%
arrange(desc(pts)) %>%
add_id() %>%
filter(ID == 1) %>%
remove_var(ID) %>%
ungroup()
df_99b <- df_torneos %>%
mutate(ind_pos = ifelse((year %in% c('1999-1','1999-2')& (pos >= 9)),1,0)) %>%
filter(year == '1999-2' & ind_pos == 1)
df_99 <- rbind(df_99a,
df_99b) %>%
mutate(year = 1999) %>%
select(-ind_pos) %>%
arrange(desc(pts)) %>%
add_id() %>%
mutate(pos = ID) %>%
select(-ID)
# Selección de todos los torneos, menos 99
df_torneos2 <- df_torneos %>%
filter(year != '1999-1',
year != '1999-2')
df_torneos2 <- rbind(df_torneos2,
df_99) %>%
arrange(year,pos)
# Cálculo para torneos cortos
df_torneos2 <- df_torneos2 %>%
group_by(equipo,
year) %>%
mutate(pts = sum(pts),
pj = sum(pj),
pg = sum(pg),
pe = sum(pe),
pp = sum(pp),
gf = sum(gf),
gc = sum(gc),
dif = (gf-gc)) %>%
arrange(desc(pts),
desc(dif),
year) %>%
add_id() %>%
filter(ID == 1) %>%
remove_var(ID) %>%
ungroup() %>%
select(-pos) %>%
group_by(year) %>%
add_id() %>%
rename('pos' = ID) %>%
ungroup()
# Cálculo de porcentaje de rendimiento y puntos con 3 pts
df_torneos2 <- df_torneos2 %>%
mutate(pts_nuevo = ifelse((year >= 1995),pts,((pg*3)+pe)),
porc = ifelse((year > 1994), 100*(pts/(pj*3)),100*(pts/(pj*2))),
year = factor(year,levels = c(1985:2013,'2013-14','2014-15','2015-16','2016-17','2017','2018')))
# Lectura de base
df_torneos <- readxl::read_xlsx('base_torneos.xlsx') %>%
janitor::clean_names()
setwd("../Desktop/GitHub/shiny_futbol/shiny_futbol/")
# Lectura de base
df_torneos <- readxl::read_xlsx('') %>%
janitor::clean_names()
# Lectura de base
df_torneos <- readxl::read_xlsx('base_torneos.xlsx') %>%
janitor::clean_names()
# Limpieza torneo 1999
df_99a <- df_torneos %>%
mutate(ind_pos = ifelse((year %in% c('1999-1','1999-2')& (pos >= 9)),1,0)) %>%
filter(year %in% c('1999-1','1999-2') & ind_pos == 0) %>%
group_by(equipo) %>%
mutate(pts = sum(pts),
pj = sum(pj),
pg = sum(pg),
pe = sum(pe),
pp = sum(pp),
gf = sum(gf),
gc = sum(gc),
dif = gf-gc) %>%
arrange(desc(pts)) %>%
add_id() %>%
filter(ID == 1) %>%
remove_var(ID) %>%
ungroup()
df_99b <- df_torneos %>%
mutate(ind_pos = ifelse((year %in% c('1999-1','1999-2')& (pos >= 9)),1,0)) %>%
filter(year == '1999-2' & ind_pos == 1)
df_99 <- rbind(df_99a,
df_99b) %>%
mutate(year = 1999) %>%
select(-ind_pos) %>%
arrange(desc(pts)) %>%
add_id() %>%
mutate(pos = ID) %>%
select(-ID)
# Selección de todos los torneos, menos 99
df_torneos2 <- df_torneos %>%
filter(year != '1999-1',
year != '1999-2')
df_torneos2 <- rbind(df_torneos2,
df_99) %>%
arrange(year,pos)
# Cálculo para torneos cortos
df_torneos2 <- df_torneos2 %>%
group_by(equipo,
year) %>%
mutate(pts = sum(pts),
pj = sum(pj),
pg = sum(pg),
pe = sum(pe),
pp = sum(pp),
gf = sum(gf),
gc = sum(gc),
dif = (gf-gc)) %>%
arrange(desc(pts),
desc(dif),
year) %>%
add_id() %>%
filter(ID == 1) %>%
remove_var(ID) %>%
ungroup() %>%
select(-pos) %>%
group_by(year) %>%
add_id() %>%
rename('pos' = ID) %>%
ungroup()
# Cálculo de porcentaje de rendimiento y puntos con 3 pts
df_torneos2 <- df_torneos2 %>%
mutate(pts_nuevo = ifelse((year >= 1995),pts,((pg*3)+pe)),
porc = ifelse((year > 1994), 100*(pts/(pj*3)),100*(pts/(pj*2))),
year = factor(year,levels = c(1985:2013,'2013-14','2014-15','2015-16','2016-17','2017','2018')))
df_torneos2 %>%
mutate(camp = case_when((year %in% c(1985:2001))& (pos == 1)~'C',
(year == 2002) & (equipo == 'Colo-Colo')~'C',
(year == 2002) & (equipo == 'Universidad Católica')~'C',
TRUE ~ ''))
df_torneos2 %>%
mutate(camp = case_when((year %in% c(1985:2001))& (pos == 1)~'C',
(year == 2002) & (equipo == 'Colo-Colo')~'C',
(year == 2002) & (equipo == 'Universidad Católica')~'C',
TRUE ~ '')) %>%
filter(year == 2002)
df_torneos2 %>%
mutate(camp = case_when((year %in% c(1985:2001,2010,2013,2017,2018))& (pos == 1)~'C',
(year == 2002) & (equipo == 'Colo-Colo')~'C',
(year == 2002) & (equipo == 'Universidad Católica')~'C',
(year == 2003) & (equipo == 'Cobreloa')~'C,C',
(year == 2004) & (equipo == 'Universidad de Chile')~'C',
(year == 2004) & (equipo == 'Cobreloa')~'C',
(year == 2005) & (equipo == 'Unión Española')~'C',
(year == 2005) & (equipo == 'Universidad Católica')~'C',
(year == 2006) & (equipo == 'Colo-Colo')~'C,C',
(year == 2007) & (equipo == 'Colo-Colo')~'C,C',
(year == 2008) & (equipo == 'Colo-Colo')~'C',
(year == 2008) & (equipo == 'Everton')~'C',
(year == 2009) & (equipo == 'Universidad de Chile')~'C',
(year == 2009) & (equipo == 'Colo-Colo')~'C',
(year == 2011) & (equipo == 'Universidad de Chile')~'C,C',
(year == 2012) & (equipo == 'Universidad de Chile')~'C',
(year == 2012) & (equipo == 'Huachipato')~'C',
(year == 2013-14) & (equipo == "O'Higgins")~'C',
(year == 2013-14) & (equipo == 'Colo-Colo')~'C',
(year == 2014-15) & (equipo == "Universidad de Chile")~'C',
(year == 2014-15) & (equipo == 'Cobresal')~'C',
(year == 2015-16) & (equipo == "Colo-Colo")~'C',
(year == 2015-16) & (equipo == 'Universidad Católica')~'C',
(year == 2016-17) & (equipo == "Universidad de Chile")~'C',
(year == 2015-16) & (equipo == 'Universidad Católica')~'C',
TRUE ~ ''))
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
shiny::runApp()
library(shiny)
library(sjmisc)
library(dplyr)
library(plotly)
library(ggplot2)
df_torneos <- readxl::read_xlsx('base_torneos.xlsx') %>%
janitor::clean_names()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
# Limpieza torneo 1999
df_99a <- df_torneos %>%
mutate(ind_pos = ifelse((year %in% c('1999-1','1999-2')& (pos >= 9)),1,0)) %>%
filter(year %in% c('1999-1','1999-2') & ind_pos == 0) %>%
group_by(equipo) %>%
mutate(pts = sum(pts),
pj = sum(pj),
pg = sum(pg),
pe = sum(pe),
pp = sum(pp),
gf = sum(gf),
gc = sum(gc),
dif = gf-gc) %>%
arrange(desc(pts)) %>%
add_id() %>%
filter(ID == 1) %>%
remove_var(ID) %>%
ungroup()
df_99b <- df_torneos %>%
mutate(ind_pos = ifelse((year %in% c('1999-1','1999-2')& (pos >= 9)),1,0)) %>%
filter(year == '1999-2' & ind_pos == 1)
df_99 <- rbind(df_99a,
df_99b) %>%
mutate(year = 1999) %>%
select(-ind_pos) %>%
arrange(desc(pts)) %>%
add_id() %>%
mutate(pos = ID) %>%
select(-ID)
# Selección de todos los torneos, menos 99
df_torneos2 <- df_torneos %>%
filter(year != '1999-1',
year != '1999-2')
df_torneos2 <- rbind(df_torneos2,
df_99) %>%
arrange(year,pos)
# Cálculo para torneos cortos
df_torneos2 <- df_torneos2 %>%
group_by(equipo,
year) %>%
mutate(pts = sum(pts),
pj = sum(pj),
pg = sum(pg),
pe = sum(pe),
pp = sum(pp),
gf = sum(gf),
gc = sum(gc),
dif = (gf-gc)) %>%
arrange(desc(pts),
desc(dif),
year) %>%
add_id() %>%
filter(ID == 1) %>%
remove_var(ID) %>%
ungroup() %>%
select(-pos) %>%
group_by(year) %>%
add_id() %>%
rename('pos' = ID) %>%
ungroup()
# Cálculo de porcentaje de rendimiento y puntos con 3 pts
df_torneos2 <- df_torneos2 %>%
mutate(pts_nuevo = ifelse((year >= 1995),pts,((pg*3)+pe)),
porc = ifelse((year > 1994), 100*(pts/(pj*3)),100*(pts/(pj*2))),
year = factor(year,levels = c(1960:2013,'2013-14','2014-15','2015-16','2016-17','2017','2018')),
camp = case_when((year %in% c(1960:1967,1971:1983,1985:2001,2010,2013,2017,2018))& (pos == 1)~'C',
(year == 1968) & (equipo == 'Santiago Wanderers')~'C',
(year == 1969) & (equipo == 'Universidad de Chile')~'C',
(year == 1970) & (equipo == 'Colo-Colo')~'C',
(year == 1984) & (equipo == 'Universidad Católica')~'C',
(year == 2002) & (equipo == 'Colo-Colo')~'C',
(year == 2002) & (equipo == 'Universidad Católica')~'C',
(year == 2003) & (equipo == 'Cobreloa')~'C,C',
(year == 2004) & (equipo == 'Universidad de Chile')~'C',
(year == 2004) & (equipo == 'Cobreloa')~'C',
(year == 2005) & (equipo == 'Unión Española')~'C',
(year == 2005) & (equipo == 'Universidad Católica')~'C',
(year == 2006) & (equipo == 'Colo-Colo')~'C,C',
(year == 2007) & (equipo == 'Colo-Colo')~'C,C',
(year == 2008) & (equipo == 'Colo-Colo')~'C',
(year == 2008) & (equipo == 'Everton')~'C',
(year == 2009) & (equipo == 'Universidad de Chile')~'C',
(year == 2009) & (equipo == 'Colo-Colo')~'C',
(year == 2011) & (equipo == 'Universidad de Chile')~'C,C',
(year == 2012) & (equipo == 'Universidad de Chile')~'C',
(year == 2012) & (equipo == 'Huachipato')~'C',
(year == '2013-14') & (equipo == "O'Higgins")~'C',
(year == '2013-14') & (equipo == 'Colo-Colo')~'C',
(year == '2014-15') & (equipo == "Universidad de Chile")~'C',
(year == '2014-15') & (equipo == 'Cobresal')~'C',
(year == '2015-16') & (equipo == "Colo-Colo")~'C',
(year == '2015-16') & (equipo == 'Universidad Católica')~'C',
(year == '2016-17') & (equipo == "Universidad de Chile")~'C',
(year == '2016-17') & (equipo == 'Universidad Católica')~'C',
TRUE ~ ''))
View(df_torneos2)
runApp()
runApp()
df_torneos2 %>%
select(year)
df_torneos2 %>%
frq(year)
df_torneos2 %>%
filter(year == c(1960:2016-17))
df_torneos2 %>%
filter(year == c(1960:'2016-17'))
df_torneos2 %>%
filter(year == c(1960:2012))
df_torneos2 %>%
filter(year == c(1960:2012))
df_torneos2 %>%
filter(year %in% c(1960:2012))
df_torneos2 %>%
filter(year %in% c(1960:2014-15))
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
